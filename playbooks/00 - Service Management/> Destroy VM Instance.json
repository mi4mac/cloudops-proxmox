{
    "@context": "\/api\/3\/contexts\/Workflow",
    "@type": "Workflow",
    "triggerLimit": null,
    "name": "> Destroy VM Instance",
    "aliasName": null,
    "tag": null,
    "description": "Destroy individual VM defined with params",
    "isActive": true,
    "debug": true,
    "singleRecordExecution": false,
    "remoteExecutableFlag": false,
    "parameters": [
        "vm_instance"
    ],
    "synchronous": false,
    "collection": "\/api\/3\/workflow_collections\/f1c80355-697f-4a71-971b-0988c871491d",
    "versions": [],
    "triggerStep": "\/api\/3\/workflow_steps\/34dd9835-35b3-4559-8ec6-562bcc1b4394",
    "steps": [
        {
            "@type": "WorkflowStep",
            "name": "Configuration",
            "description": null,
            "arguments": {
                "vm_name": "{{vars.input.records[0].name}}",
                "vm_type": "{{vars.input.records[0].vMType.itemValue|lower}}"
            },
            "status": null,
            "top": "165",
            "left": "300",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "7a6b6d01-6cc7-4eea-8e6a-95cc69a12893"
        },
        {
            "@type": "WorkflowStep",
            "name": "Destroyed Successfully",
            "description": null,
            "arguments": {
                "conditions": [
                    {
                        "option": "yes",
                        "step_iri": "\/api\/3\/workflow_steps\/ed1621c8-a7c0-40ed-b814-7359d087d75c",
                        "condition": "{{ \"successfully destroyed\" in vars.cmd_result }}",
                        "step_name": "Update Successfully Destroyed VM"
                    },
                    {
                        "option": "no",
                        "default": true,
                        "step_iri": "\/api\/3\/workflow_steps\/bd4d8207-cbed-43b0-b22a-99ce1eb49871",
                        "step_name": "Update Failed Destroyed VM"
                    }
                ],
                "step_variables": []
            },
            "status": null,
            "top": "705",
            "left": "300",
            "stepType": "\/api\/3\/workflow_step_types\/12254cf5-5db7-4b1a-8cb1-3af081924b28",
            "group": null,
            "uuid": "b96b9f82-95f5-4fda-8734-303c480208c2"
        },
        {
            "@type": "WorkflowStep",
            "name": "Get CMD Result",
            "description": null,
            "arguments": {
                "cmd_result": "{{vars.steps.Run_Deprovisioning_CMD.data or vars.steps.Run_Deprovisioning_CMD['Error message'] or vars.steps.Run_Deprovisioning_CMD.error or vars.steps.Run_Deprovisioning_CMD.output or 'No output captured'}}"
            },
            "status": null,
            "top": "570",
            "left": "300",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "1a54dff3-8a28-4c74-af50-f1ff99b8f3c6"
        },
        {
            "@type": "WorkflowStep",
            "name": "Run Deprovisioning CMD",
            "description": null,
            "arguments": {
                "name": "SSH",
                "config": "36787c2e-5ae6-4a55-a4f9-de80281aa40e",
                "params": {
                    "cmd": "{{vars.deprovision_cmd}}",
                    "allowed_exit": "-1,0,1",
                    "is_super_user": false
                },
                "version": "2.1.3",
                "connector": "ssh",
                "operation": "run_remote_command",
                "ignore_errors": true,
                "operationTitle": "Execute remote command",
                "pickFromTenant": false,
                "step_variables": []
            },
            "status": null,
            "top": "435",
            "left": "300",
            "stepType": "\/api\/3\/workflow_step_types\/0bfed618-0316-11e7-93ae-92361f002671",
            "group": null,
            "uuid": "d9df50d4-f852-406e-90cb-e472e58d7c5b"
        },
        {
            "@type": "WorkflowStep",
            "name": "Set Deprovisioning CMD",
            "description": null,
            "arguments": {
                "deprovision_cmd": "\/usr\/bin\/bash \/root\/destroy_{{vars.vm_type}}.sh {{vars.vm_name}}"
            },
            "status": null,
            "top": "300",
            "left": "300",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "b693f962-ca51-47dc-8b21-fd58e6a25ef7"
        },
        {
            "@type": "WorkflowStep",
            "name": "Start",
            "description": null,
            "arguments": {
                "route": "0dd31438-c83b-4948-b7ef-1b8b23ad1452",
                "resources": [
                    "v_m_instances"
                ],
                "__triggerLimit": true,
                "inputVariables": [],
                "step_variables": {
                    "input": {
                        "params": [],
                        "records": "{{vars.input.records}}"
                    },
                    "_update_records_env": "{%- if vars.input.params.vm_instance and vars.input.params.vm_instance | length > 0 -%}{{vars.input.records.append(vars.input.params.vm_instance)}}{%-endif-%}"
                },
                "triggerOnSource": true,
                "displayConditions": {
                    "v_m_instances": {
                        "sort": [],
                        "limit": 30,
                        "logic": "AND",
                        "filters": []
                    }
                },
                "executeButtonText": "Execute",
                "noRecordExecution": false,
                "showToasterMessage": {
                    "visible": false,
                    "messageVisible": true
                },
                "triggerOnReplicate": false,
                "singleRecordExecution": true
            },
            "status": null,
            "top": "30",
            "left": "300",
            "stepType": "\/api\/3\/workflow_step_types\/f414d039-bb0d-4e59-9c39-a8f1e880b18a",
            "group": null,
            "uuid": "34dd9835-35b3-4559-8ec6-562bcc1b4394"
        },
        {
            "@type": "WorkflowStep",
            "name": "Update Failed Destroyed VM",
            "description": null,
            "arguments": {
                "resource": {
                    "logs": "<p>{{vars.cmd_result|replace('\\r\\n','&lt;br&gt;')}}<\/p>",
                    "status": "\/api\/3\/picklists\/3a009813-79af-4d41-8eeb-cec911d4821c"
                },
                "operation": "Append",
                "collection": "{{vars.input.records[0]['@id']}}",
                "__recommend": [],
                "collectionType": "\/api\/3\/v_m_instances",
                "fieldOperation": {
                    "recordTags": "Append"
                },
                "step_variables": []
            },
            "status": null,
            "top": "840",
            "left": "475",
            "stepType": "\/api\/3\/workflow_step_types\/b593663d-7d13-40ce-a3a3-96dece928722",
            "group": null,
            "uuid": "bd4d8207-cbed-43b0-b22a-99ce1eb49871"
        },
        {
            "@type": "WorkflowStep",
            "name": "Update Successfully Destroyed VM",
            "description": null,
            "arguments": {
                "resource": {
                    "logs": "<p>{{vars.cmd_result|replace('\\r\\n','&lt;br&gt;')}}<\/p>",
                    "status": "\/api\/3\/picklists\/87e8de7b-4ca7-41f2-b3ee-bc367faf489c"
                },
                "operation": "Append",
                "collection": "{{vars.input.records[0]['@id']}}",
                "__recommend": [],
                "collectionType": "\/api\/3\/v_m_instances",
                "fieldOperation": {
                    "recordTags": "Append"
                },
                "step_variables": []
            },
            "status": null,
            "top": "840",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/b593663d-7d13-40ce-a3a3-96dece928722",
            "group": null,
            "uuid": "ed1621c8-a7c0-40ed-b814-7359d087d75c"
        }
    ],
    "routes": [
        {
            "@type": "WorkflowRoute",
            "name": "Configuration -> Set Provisioning CMD",
            "targetStep": "\/api\/3\/workflow_steps\/b693f962-ca51-47dc-8b21-fd58e6a25ef7",
            "sourceStep": "\/api\/3\/workflow_steps\/7a6b6d01-6cc7-4eea-8e6a-95cc69a12893",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "87c3a4c1-42bd-463c-be29-7c42e12a230e"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Destroyed Successfully -> Copy of Update Destroyed VM Instance",
            "targetStep": "\/api\/3\/workflow_steps\/bd4d8207-cbed-43b0-b22a-99ce1eb49871",
            "sourceStep": "\/api\/3\/workflow_steps\/b96b9f82-95f5-4fda-8734-303c480208c2",
            "label": "no",
            "isExecuted": false,
            "group": null,
            "uuid": "b0843a14-5445-47b0-b153-335cbb1c08b1"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Destroyed Successfully -> Update Destroyed VM Instance",
            "targetStep": "\/api\/3\/workflow_steps\/ed1621c8-a7c0-40ed-b814-7359d087d75c",
            "sourceStep": "\/api\/3\/workflow_steps\/b96b9f82-95f5-4fda-8734-303c480208c2",
            "label": "yes",
            "isExecuted": false,
            "group": null,
            "uuid": "b6b842b6-de6c-4568-af48-6586089dc36a"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Get CMD Result -> Destroyed Successfully",
            "targetStep": "\/api\/3\/workflow_steps\/b96b9f82-95f5-4fda-8734-303c480208c2",
            "sourceStep": "\/api\/3\/workflow_steps\/1a54dff3-8a28-4c74-af50-f1ff99b8f3c6",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "fe91c313-eda2-480f-968a-6a579179d491"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Run Deprovisioning CMD -> Get CMD Result",
            "targetStep": "\/api\/3\/workflow_steps\/1a54dff3-8a28-4c74-af50-f1ff99b8f3c6",
            "sourceStep": "\/api\/3\/workflow_steps\/d9df50d4-f852-406e-90cb-e472e58d7c5b",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "a6ca3695-3997-4c99-a442-4b1efe31c978"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Set Deprovisioning CMD -> Run Provisioning CMD",
            "targetStep": "\/api\/3\/workflow_steps\/d9df50d4-f852-406e-90cb-e472e58d7c5b",
            "sourceStep": "\/api\/3\/workflow_steps\/b693f962-ca51-47dc-8b21-fd58e6a25ef7",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "4539c6c5-714c-4984-8a67-36e4ec7c4816"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Start -> Configuration",
            "targetStep": "\/api\/3\/workflow_steps\/7a6b6d01-6cc7-4eea-8e6a-95cc69a12893",
            "sourceStep": "\/api\/3\/workflow_steps\/34dd9835-35b3-4559-8ec6-562bcc1b4394",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "255f9760-b486-412c-b8ca-4a107639b587"
        }
    ],
    "groups": [],
    "priority": "\/api\/3\/picklists\/2b563c61-ae2c-41c0-a85a-c9709585e3f2",
    "playbookOrigin": "\/api\/3\/picklists\/15c1e8c9-22bf-4e66-8fbb-0a502d4a4a3f",
    "isEditable": true,
    "uuid": "41ea49b2-01a1-47c0-a66b-29e1f844135d",
    "owners": [],
    "isPrivate": false,
    "deletedAt": null,
    "recordTags": [
        "Destroy"
    ]
}